#!/bin/sh
filenameOnly=$(echo "$1" | rev | cut -d'.' -f2- | rev)
echo "$1" | grep -q -F '.c' || return 1
# grep -q -F 'int main' $1 || echo 'int main(){ return 0; }' >> $1
touch "$filenameOnly".s
{
	gcc -gdwarf -g -w -fverbose-asm -O2 -S $1
	fileSize=$(stat --printf="%s" "$filenameOnly".c)
	while :
	do
		tmpSize=$(stat --printf="%s" "$filenameOnly".c)
		[ "$tmpSize" -ne "$fileSize" ] && gcc -gdwarf -g -w -O2 -S $1
		sleep 1
	done
} &
nvim -c ":vsplit $filenameOnly.c" "$filenameOnly".s
