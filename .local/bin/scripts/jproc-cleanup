#!/bin/sh

set -eu

if [ $(uname) = 'Linux' ] && 0; then
	# ~/.zsh/jproc-cleanup.c uses /proc/[pid] which depends on Linux
	jproc-cleanup-bin
else
	if [ ! "$JPROC_DIR" ] || [ -z "$JPROC_DIR" ] || ! [ -d "$JPROC_DIR" ] || ! cd "$JPROC_DIR"; then
		echo "$JPROC_DIR dir not found"
		exit 1
	fi
	# open $JPROC_DIR/[pid]
	for pid in $(echo [0-9]*); do
		if [ -d $pid ]; then
			# remove if inactive pid
			if kill -0 "$pid" >/dev/null 2>/dev/null; then
				rm $pid/[0-9A-Za-z]*
				rmdir "$pid"
			fi
		fi
	done
fi
