#!/bin/sh
img_clean="${1%.*}"
for opt in $@
do
	case $opt in
		*.png|*.jpg);;
		*x*)
			r=$opt
			h=${r#*x};;
		*)
			if aredigit $opt
			then
				r=$opt
				h=$opt
			else
				echo 'usage: res4thumbnail <image> <res>'
				echo 'Not an image file!'
				return 1
			fi
	esac
done
upndownscale(){
	waifu2xauto "$1" "$2"
	res "$img_clean-hd.png" "$r"
	sq "$img_clean-hd-resized.png"
	echo "$img has been upscaled $2x."
}
scale=$(getres "$img" | awk -v h="$h" '{print int(h/$2 + 0.99)}')
if test $scale -le 1
then
	echo "$1 need not be upscaled"
	return
elif test $scale -le 4
then
	scale=4
elif test $scale -le 16
then
	scale=16
elif test $scale -le 32
then
	scale=32
elif test $scale -le 64
then
	scale=64
fi
upndownscale "$img" $scale
