#!/usr/bin/bash
img=$1
img_clean="${1%.*}"
case $1 in
	*.png);; *.jpg);;
	'')
		echo "Usage: res4thumbnail <image> <resolution>"
		return 1;;
	*)
		echo 'Not an image file!'
		return 1
esac
expr "$1" : '.*png' || topng "$1"
case $2 in
	'')
		height=720
		resolution='1280x720';;
	*x*)
		resolution=$2
		height=$(echo "$resolution" | cut -d'x' -f2);;
	*)
	case "$2" in
		'720') height=720;;
		'1080') height=1080;;
		'1440') height=1440;;
		'4k') height=2160;;
	esac
esac
upndownscale(){
	waifu2xauto "$1" "$2"
	res "$img_clean-hd.png" "$resolution"
	sq "$img_clean-hd-resized.png"
	echo "$1 has been upscaled $2x."
}
scale=$(getres "$img" | awk -v h="$height" '{print int(h/$2 + 0.99)}')
if [ 1 -ge "$scale" ]
then
	echo "'$1' need not be upscaled"
	res "$img" "$resolution"
	return
elif [ 4 -ge "$scale" ]
then
	upscale=4
elif [ 16 -ge "$scale" ]
then
	upscale=16
else
	upscale=64
fi
upndownscale "$img" $upscale
