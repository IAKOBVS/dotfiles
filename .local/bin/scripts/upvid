#!/bin/sh
newdir=upscaled
mkdir -p $newdir
for file in "$@"; do
	ext=${file##*.}
	file_wo_ext=${file##*/}
	file_wo_ext=${file_wo_ext%.*}
	upscaled="$file_wo_ext"_upscaled."$ext"
	mpv "$file" --no-sub --glsl-shaders="~~/shaders/Anime4K_Clamp_Highlights.glsl:~~/shaders/Anime4K_Restore_CNN_M.glsl:~~/shaders/Anime4K_Upscale_CNN_x2_M.glsl:~~/shaders/Anime4K_Restore_CNN_S.glsl:~~/shaders/Anime4K_AutoDownscalePre_x2.glsl:~~/shaders/Anime4K_AutoDownscalePre_x4.glsl:~~/shaders/Anime4K_Upscale_CNN_x2_S.glsl" -vf=gpu="w=1920:h=1080" --o="$upscaled"
	i=0
	while [ "$i" -ne "$(subtracks "$file")" ]; do
		srt="$file_wo_ext"_upscaled_"$i".srt
		ffmpeg -i "$file" -map "0:s:$i" "$srt"
		test "$subs" && subs=' '
		subs="$subs$srt"
		i=$((i + 1))
	done
	addsub "$upscaled" $subs
	# rm "$upscaled.bak"
done
