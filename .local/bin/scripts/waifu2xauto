#!/bin/sh
case $1 in
	*.png);; *.jpg);;
	*)
		echo 'Not an image file!'
		return
esac
if [ -z "$2" ]
then
	echo "Usage: waifu2xauto <image> <scale>"
	return
fi
baseScale=4
upscaler=realesrgan-x4plus-anime
out="$(cleanext "$1")-hd.png"
realesr(){ realesrgan-ncnn-vulkan -f png -i "$1" -o "$2" -s "$3" -n "$4" -v;}
if [ "$2" -le 4 ]
then
	max=0
elif [ "$2" -le 16 ]
then
	max=1
else
	max=2
fi
realesr "$1" "$out" "$baseScale" "$upscaler"
i=0
while [ $i -lt $max ]; do
	realesr "$out" "$out" "$baseScale" "$upscaler"
	i=$((i=i+1))
done
