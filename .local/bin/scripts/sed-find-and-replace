#!/bin/sh
if [ $# -lt 3 ]; then
	echo "Usage: $(dirname "$0") <find> <replace> <filename>"
	exit
fi
find=$1
replace=$2
shift
shift
#shellcheck disable=SC2068
awk -v f="$find" -v r="$replace" '{ if (gsub(f, r)) print }' $@
wait
echo
echo "Files to be changed: $*"
echo 'Are you sure? [Y/n]'
echo
read -r ok
[ "$ok" != 'Y' ] && exit
#shellcheck disable=SC2068
for file in $@; do
	#shellcheck disable=SC2005
	echo "$(awk -v f="$find" -v r="$replace" '{gsub(f, r); print;}' "$file")" >"$file" &
done
wait
echo "Files changed: $*"
